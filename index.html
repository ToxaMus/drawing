<html>

<head>
    <meta charset="UTF-8">
    <link href="main.css" rel="stylesheet">
    <script src="Figurs.js"></script>
</head>

<body>
    <div style="margin: 10px;">
        <canvas id="lineY" width="40" height="800"></canvas>
        <canvas id="canvas" width="800" height="800">
            <canvas id="canvas" width="800" height="800" style="flex: 1; margin-right: 2em;">
                <div style="flex: 1; margin-right: 2em;">VNJ</div>
            </canvas>
        </canvas>
    </div>

    <canvas id="lineX" width="800" height="33" style="margin-bottom: 1em"></canvas>

    <div> Геометрическая фигура:
        <select id="geometryType">
            <option value="line">Линия</option>
            <option value="triangle">Треугольник</option>
            <option value="rectangle">Прямоугольник</option>
            <option value="circle">круг</option>
            <option value="rhombus">ромб</option>
            <option value="parallelogram">параллелограмм</option>
            <option value="trapezoid">трапеция</option>
            <option value="rubber">резинка</option>
        </select>
    </div>

    <div>
        <div id="message"> Задайте координату точки:</div>
        <input type="text" id="coordinateInput">
    </div>
</body>

<script>

    const canvas = document.getElementById("canvas");
    const context = canvas.getContext("2d");

    coordinateTable(context)
    rulerY();
    rulerX();

    const geometryTypeElement = document.getElementById("geometryType");

    let geometryType;
    let polygon = [];
    let num = 0;

    geometryTypeElement.addEventListener('change', (event) => {
        geometryType = geometryTypeElement.value;
        num = 0;
        polygon = [];
        newFigure(geometryType);
    })

    let coord;
    let radius;
    let width;
    let height;

    const inputElement = document.getElementById("coordinateInput");

    inputElement.addEventListener('keyup', (event) => {
        if (event.code == "Escape") {
            newFigure(geometryType);
            num = 0
            polygon = [];
            width = undefined;
        }

        if (clickOnEnter(event)) {
            coord = stringToCoordinate(inputElement.value);

            if (geometryType === 'line' || geometryType === undefined) {
                if (!errorCoordinate(coord)) {
                    polygon.push({ x: coord[0], y: coord[1] });
                    document.getElementById("message").innerHTML = "Задайте следущую координату через ';':"
                }

                if (polygon.length > 1) {
                    drawLine(polygon, context)
                }
            }

            if (geometryType === 'triangle') {
                if (!errorCoordinate(coord)) {
                    polygon.push({ x: coord[0], y: coord[1] })
                    document.getElementById("message").innerHTML = "Задайте следущую координату через ';'"
                }

                if (polygon.length === 3) {
                    drawTriangle(polygon, context);
                    polygon = []
                    document.getElementById("message").innerHTML = "Задайте координату точки:"
                }
            }

            if (geometryType === 'rectangle') {
                if (polygon.length < 2 && !errorCoordinate(coord)) {
                    polygon.push({ x: coord[0], y: coord[1] })
                    document.getElementById("message").innerHTML = "Задайте накрестлежащую координату"
                }

                if (polygon.length == 2) {
                    drawReactangle(polygon, context, geometryType)
                    polygon = [];
                    document.getElementById("message").innerHTML = "Задайте координату точки:"
                }
            }

            if (geometryType === 'circle') {
                if (polygon.length < 1) {
                    if (!errorCoordinate(coord)) {
                        polygon.push({ x: coord[0], y: coord[1] })
                        document.getElementById("message").innerHTML = "Задайте радиус"
                    }
                }

                if (num == 1 && !errorData(coord[0])) {
                    radius = coord[0];
                    drawCircle(polygon, radius, context);

                    polygon = [];
                    num = 0;
                    document.getElementById("message").innerHTML = "Задайте координату точки:";
                }

                if (polygon.length == 1) {
                    num = 1;
                }
            }

            if (geometryType === "rhombus") {
                if (polygon.length < 4) {
                    if (!errorCoordinate(coord)) {
                        polygon.push({ x: coord[0], y: coord[1] });

                        if (polygon.length === 2) {
                            document.getElementById("message").innerHTML = "Задайте координаты второй диагонали:";

                            drawLine(polygon, context);
                        }

                    }

                    if (polygon.length == 4) {
                        drawHrombus(polygon, context);

                        document.getElementById("message").innerHTML = "Задайте координаты первой диагонали:";
                        polygon = [];

                    }
                }
            }

            if (geometryType === "parallelogram" || geometryType === "trapezoid") {
                if (polygon.length <= 4) {
                    if (!errorCoordinate(coord)) {
                        polygon.push({ x: coord[0], y: coord[1] });

                        if (polygon.length == 2) {
                            document.getElementById("message").innerHTML = "Задайте координаты параллельной этой прямой";

                            drawLine(polygon, context);
                        }
                    }
                }

                if (polygon.length == 4) {
                    drawParallelogram(context, polygon);

                    document.getElementById("message").innerHTML = "Задайте координаты точек первой прямой:";
                    polygon = [];
                }

            }

            if (geometryType == "rubber") {
                if (polygon.length < 1 && !errorCoordinate(coord)) {
                    polygon.push({ x: coord[0], y: coord[1] });
                    document.getElementById("message").innerHTML = "Задайте длину";
                }

                if (!errorData(width) ) {
                    height = coord[0];
                    rubber(polygon, width, height, context);

                    polygon = [];
                    num = 0;
                    width = undefined;
                    document.getElementById("message").innerHTML = "Задайте координату точки:";                                      
                }

                if (polygon.length == 1 && num == 1 && !errorData(coord[0])) {
                    width = coord[0];
                    document.getElementById("message").innerHTML = "Задайте ширину";   
                }

                if (polygon.length == 1) {
                    num = 1; 
                }
            }

            inputElement.value = '';
        }
    })

</script>

</html>
